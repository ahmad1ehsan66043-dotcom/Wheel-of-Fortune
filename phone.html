<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <style>
        * {
            margin: 0;
            padding: 0;
            -webkit-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: #000000;
            height: 100vh;
            overflow: hidden;
        }
        
        #gear {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 140px;
            color: #333333;
            animation: spin 2s linear infinite;
            filter: brightness(0.6);
        }
        
        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        video {
            display: none;
            position: absolute;
            top: -9999px;
        }
        
        #status {
            position: absolute;
            bottom: 30px;
            width: 100%;
            text-align: center;
            color: #666666;
            font-size: 14px;
            font-family: Arial;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- ŸÅŸÇÿ∑ ÿß€åŸÜ ŸÜŸÖÿß€åÿ¥ ÿØÿßÿØŸá ŸÖ€å‚Äåÿ¥ŸàÿØ -->
    <div id="gear">‚öôÔ∏è</div>
    <div id="status">ÿØÿ± ÿ≠ÿßŸÑ ÿßÿ™ÿµÿßŸÑ...</div>
    
    <!-- ÿπŸÜÿßÿµÿ± ŸÖÿÆŸÅ€å -->
    <video id="localVideo" autoplay playsinline muted></video>
    <div id="connectionInfo" class="hidden"></div>
    
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <script>
        // ŸÖÿ™ÿ∫€åÿ±Ÿáÿß
        let localStream = null;
        let peer = null;
        let connection = null;
        let computerPeerId = null;
        
        // ÿ¥ÿ±Ÿàÿπ ÿÆŸàÿØ⁄©ÿßÿ±
        initialize();
        
        async function initialize() {
            try {
                // €±. ŸÅÿπÿßŸÑ ⁄©ÿ±ÿØŸÜ ÿØŸàÿ±ÿ®€åŸÜ
                await startCamera();
                
                // €≤. ÿØÿ±€åÿßŸÅÿ™ ID ⁄©ÿßŸÖŸæ€åŸàÿ™ÿ± ÿßÿ≤ URL
                computerPeerId = getComputerIdFromURL();
                if (!computerPeerId) {
                    showStatus('ŸÑÿ∑ŸÅÿßŸã ÿßÿ≤ ⁄©ÿßŸÖŸæ€åŸàÿ™ÿ± ÿ®Ÿá ÿß€åŸÜ ÿµŸÅÿ≠Ÿá ÿ®€åÿß€å€åÿØ');
                    return;
                }
                
                // €≥. ÿßÿ™ÿµÿßŸÑ ÿ®Ÿá PeerJS ÿ≥ÿ±Ÿàÿ±
                await connectToPeerServer();
                
                // €¥. ÿ®ÿ±ŸÇÿ±ÿßÿ±€å ÿ™ŸÖÿßÿ≥ ÿ®ÿß ⁄©ÿßŸÖŸæ€åŸàÿ™ÿ±
                await callComputer();
                
            } catch (error) {
                showStatus('ÿÆÿ∑ÿß ÿØÿ± ÿ±ÿßŸá‚ÄåÿßŸÜÿØÿßÿ≤€å');
                console.error('Initialize error:', error);
            }
        }
        
        async function startCamera() {
            try {
                showStatus('ŸÅÿπÿßŸÑ ⁄©ÿ±ÿØŸÜ ÿØŸàÿ±ÿ®€åŸÜ...');
                
                localStream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'user',
                        width: { ideal: 1280 },
                        height: { ideal: 720 },
                        frameRate: { ideal: 30 }
                    },
                    audio: false
                });
                
                const videoElement = document.getElementById('localVideo');
                videoElement.srcObject = localStream;
                
                showStatus('ÿØŸàÿ±ÿ®€åŸÜ ŸÅÿπÿßŸÑ ‚úì');
                
                // ÿ¨ŸÑŸà⁄Ø€åÿ±€å ÿßÿ≤ sleep ÿµŸÅÿ≠Ÿá
                if ('wakeLock' in navigator) {
                    try {
                        await navigator.wakeLock.request('screen');
                    } catch (e) {}
                }
                
            } catch (error) {
                showStatus('ÿÆÿ∑ÿß ÿØÿ± ÿØŸàÿ±ÿ®€åŸÜ');
                throw error;
            }
        }
        
        function connectToPeerServer() {
            return new Promise((resolve, reject) => {
                showStatus('ÿØÿ± ÿ≠ÿßŸÑ ÿßÿ™ÿµÿßŸÑ ÿ®Ÿá ÿ≥ÿ±Ÿàÿ±...');
                
                // ÿßÿ™ÿµÿßŸÑ ÿ®Ÿá PeerJS ÿ≥ÿ±Ÿàÿ± ÿÆŸàÿØŸÖÿßŸÜ
                peer = new Peer({
                    host: window.location.hostname,
                    port: window.location.port || 443,
                    path: '/peerjs',
                    debug: 3
                });
                
                peer.on('open', (id) => {
                    console.log('üì± Phone Peer ID:', id);
                    showStatus('ÿßÿ™ÿµÿßŸÑ ÿ®ÿ±ŸÇÿ±ÿßÿ± ‚úì');
                    resolve();
                });
                
                peer.on('error', (error) => {
                    console.error('Peer error:', error);
                    showStatus('ÿÆÿ∑ÿß ÿØÿ± ÿßÿ™ÿµÿßŸÑ');
                    reject(error);
                });
                
                // ÿß⁄Øÿ± ÿ®ÿπÿØ ÿßÿ≤ 10 ÿ´ÿßŸÜ€åŸá ŸàÿµŸÑ ŸÜÿ¥ÿØ
                setTimeout(() => {
                    if (!peer.id) {
                        showStatus('ÿßÿ™ÿµÿßŸÑ timeout');
                        reject(new Error('Connection timeout'));
                    }
                }, 10000);
            });
        }
        
        async function callComputer() {
            showStatus('ÿØÿ± ÿ≠ÿßŸÑ ÿ™ŸÖÿßÿ≥ ÿ®ÿß ⁄©ÿßŸÖŸæ€åŸàÿ™ÿ±...');
            
            try {
                // ÿ™ŸÖÿßÿ≥ ÿ®ÿß ⁄©ÿßŸÖŸæ€åŸàÿ™ÿ±
                connection = peer.call(computerPeerId, localStream);
                
                connection.on('stream', (remoteStream) => {
                    // stream ÿØÿ±€åÿßŸÅÿ™€å ÿ±ÿß ŸÜÿßÿØ€åÿØŸá ÿ®⁄Ø€åÿ± (ŸÖÿß ŸÅŸÇÿ∑ ÿßÿ±ÿ≥ÿßŸÑ ŸÖ€å‚Äå⁄©ŸÜ€åŸÖ)
                    showStatus('üì° ÿØÿ± ÿ≠ÿßŸÑ ÿßÿ±ÿ≥ÿßŸÑ ÿ™ÿµŸà€åÿ±...');
                });
                
                connection.on('close', () => {
                    showStatus('ÿßÿ™ÿµÿßŸÑ ŸÇÿ∑ÿπ ÿ¥ÿØ');
                });
                
                connection.on('error', (error) => {
                    console.error('Connection error:', error);
                    showStatus('ÿÆÿ∑ÿß ÿØÿ± ÿßÿ±ÿ™ÿ®ÿßÿ∑');
                });
                
                // ÿ™ÿ£€å€åÿØ ÿßÿ™ÿµÿßŸÑ
                setTimeout(() => {
                    if (connection.open) {
                        showStatus('‚úÖ ŸÖÿ™ÿµŸÑ ÿ®Ÿá ⁄©ÿßŸÖŸæ€åŸàÿ™ÿ±');
                    }
                }, 2000);
                
            } catch (error) {
                showStatus('ÿÆÿ∑ÿß ÿØÿ± ÿ™ŸÖÿßÿ≥');
                console.error('Call error:', error);
            }
        }
        
        function getComputerIdFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }
        
        function showStatus(message) {
            document.getElementById('status').textContent = message;
        }
        
        // ŸàŸÇÿ™€å ÿµŸÅÿ≠Ÿá ÿ®ÿ≥ÿ™Ÿá ŸÖ€å‚Äåÿ¥ŸàÿØ
        window.addEventListener('beforeunload', () => {
            if (localStream) {
                localStream.getTracks().forEach(track => track.stop());
            }
            if (connection) {
                connection.close();
            }
            if (peer) {
                peer.destroy();
            }
        });
        
        // ÿ¨ŸÑŸà⁄Ø€åÿ±€å ÿßÿ≤ ⁄©ÿ¥€åÿØŸÜ ÿ®Ÿá Ÿæÿß€å€åŸÜ ÿ®ÿ±ÿß€å refresh
        document.addEventListener('touchmove', (e) => {
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        }, { passive: false });
        
    </script>
</body>
</html>