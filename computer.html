<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù¾Ù†Ù„ Ú©Ù†ØªØ±Ù„ Ø¯ÙˆØ±Ø¨ÛŒÙ†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #f1f5f9;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            border: 1px solid #334155;
            text-align: center;
        }
        
        h1 {
            color: #60a5fa;
            margin-bottom: 15px;
            font-size: 2.5rem;
        }
        
        .id-section {
            background: rgba(15, 23, 42, 0.8);
            padding: 25px;
            border-radius: 15px;
            margin: 30px auto;
            max-width: 800px;
            border: 1px solid #475569;
            text-align: center;
        }
        
        .peer-id {
            background: #0f172a;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 1.5rem;
            letter-spacing: 2px;
            color: #4ade80;
            margin: 20px 0;
            border: 2px solid #4ade80;
            word-break: break-all;
        }
        
        .video-container {
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            margin: 30px 0;
            position: relative;
            min-height: 500px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #334155;
        }
        
        #remoteVideo {
            width: 100%;
            max-height: 70vh;
            display: none;
        }
        
        .placeholder {
            color: #64748b;
            text-align: center;
            padding: 40px;
        }
        
        .placeholder-icon {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 18px 35px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 220px;
            justify-content: center;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        .btn:active {
            transform: translateY(-1px);
        }
        
        .btn:disabled {
            background: #475569;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        .status-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .status-card {
            background: rgba(30, 41, 59, 0.8);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid #334155;
        }
        
        .status-label {
            color: #94a3b8;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        .status-value {
            font-size: 1.8rem;
            font-weight: bold;
        }
        
        .status-online {
            color: #4ade80;
        }
        
        .status-offline {
            color: #f87171;
        }
        
        .notification {
            position: fixed;
            top: 30px;
            right: 30px;
            background: #10b981;
            color: white;
            padding: 20px 30px;
            border-radius: 12px;
            z-index: 1000;
            animation: slideIn 0.3s ease;
            display: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 400px;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .connection-url {
            background: #0f172a;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid #475569;
            font-family: monospace;
            word-break: break-all;
            color: #cbd5e1;
            font-size: 0.9rem;
        }
        
        .instructions {
            background: rgba(30, 41, 59, 0.6);
            padding: 25px;
            border-radius: 15px;
            margin: 30px 0;
            border-left: 4px solid #60a5fa;
        }
        
        .instructions ol {
            padding-right: 20px;
            line-height: 2;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            header {
                padding: 20px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .btn {
                min-width: 100%;
                margin-bottom: 10px;
            }
            
            .peer-id {
                font-size: 1.2rem;
                padding: 15px;
            }
        }
        
        .live-badge {
            position: absolute;
            top: 20px;
            left: 20px;
            background: #ef4444;
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
            display: none;
            animation: pulse 1.5s infinite;
            z-index: 10;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div class="notification" id="notification"></div>
    
    <div class="container">
        <header>
            <h1>ğŸ¬ Ù¾Ù†Ù„ Ú©Ù†ØªØ±Ù„ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø²Ù†Ø¯Ù‡</h1>
            <p>ØªØµÙˆÛŒØ± Ù…Ø³ØªÙ‚ÛŒÙ… Ø§Ø² Ø¯ÙˆØ±Ø¨ÛŒÙ† Ú¯ÙˆØ´ÛŒ Ø´Ù…Ø§</p>
        </header>
        
        <div class="id-section">
            <h3>ğŸ”‘ Ø´Ù†Ø§Ø³Ù‡ Ø§ØªØµØ§Ù„ Ø´Ù…Ø§:</h3>
            <div class="peer-id" id="peerIdDisplay">Ø¯Ø± Ø­Ø§Ù„ ØªÙˆÙ„ÛŒØ¯...</div>
            
            <div class="connection-url" id="phoneUrlDisplay">
                Ù„ÛŒÙ†Ú© Ú¯ÙˆØ´ÛŒ: Ø¯Ø± Ø­Ø§Ù„ ØªÙˆÙ„ÛŒØ¯...
            </div>
            
            <div class="controls">
                <button class="btn btn-primary" onclick="copyPeerId()">
                    ğŸ“‹ Ú©Ù¾ÛŒ Ø´Ù†Ø§Ø³Ù‡
                </button>
                <button class="btn btn-success" onclick="copyPhoneUrl()">
                    ğŸ“± Ú©Ù¾ÛŒ Ù„ÛŒÙ†Ú© Ú¯ÙˆØ´ÛŒ
                </button>
                <button class="btn btn-danger" onclick="disconnectAll()" id="disconnectBtn" disabled>
                    ğŸ”Œ Ù‚Ø·Ø¹ Ø§ØªØµØ§Ù„
                </button>
            </div>
        </div>
        
        <div class="instructions">
            <h3>ğŸ“‹ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡:</h3>
            <ol>
                <li>Ø´Ù†Ø§Ø³Ù‡ Ø¨Ø§Ù„Ø§ Ø±Ø§ Ú©Ù¾ÛŒ Ú©Ù†ÛŒØ¯</li>
                <li>Ù„ÛŒÙ†Ú© Ú¯ÙˆØ´ÛŒ Ø±Ø§ Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ú¯ÙˆØ´ÛŒ Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯</li>
                <li>Ø¨Ù‡ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø§Ø¬Ø§Ø²Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯Ù‡ÛŒØ¯</li>
                <li>ØªØµÙˆÛŒØ± Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯</li>
            </ol>
        </div>
        
        <div class="video-container">
            <div class="live-badge" id="liveBadge">â— LIVE</div>
            
            <div class="placeholder" id="videoPlaceholder">
                <div class="placeholder-icon">ğŸ“±</div>
                <h3>Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø§ØªØµØ§Ù„ Ø§Ø² Ú¯ÙˆØ´ÛŒ...</h3>
                <p>Ù„Ø·ÙØ§Ù‹ Ù„ÛŒÙ†Ú© Ø±Ø§ Ø±ÙˆÛŒ Ú¯ÙˆØ´ÛŒ Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯</p>
            </div>
            
            <video id="remoteVideo" autoplay playsinline></video>
        </div>
        
        <div class="status-bar">
            <div class="status-card">
                <div class="status-label">ÙˆØ¶Ø¹ÛŒØª Ø³Ø±ÙˆØ±</div>
                <div class="status-value status-online" id="serverStatus">ğŸŸ¢ Ø¢Ù†Ù„Ø§ÛŒÙ†</div>
            </div>
            
            <div class="status-card">
                <div class="status-label">ÙˆØ¶Ø¹ÛŒØª Ø§ØªØµØ§Ù„</div>
                <div class="status-value status-offline" id="connectionStatus">â³ Ù…Ù†ØªØ¸Ø±</div>
            </div>
            
            <div class="status-card">
                <div class="status-label">Ø¯ÙˆØ±Ø¨ÛŒÙ† Ú¯ÙˆØ´ÛŒ</div>
                <div class="status-value status-offline" id="cameraStatus">ğŸ“´ ØºÛŒØ±ÙØ¹Ø§Ù„</div>
            </div>
            
            <div class="status-card">
                <div class="status-label">Ú©ÛŒÙÛŒØª ØªØµÙˆÛŒØ±</div>
                <div class="status-value" id="qualityStatus">--</div>
            </div>
        </div>
        
        <div class="controls">
            <button class="btn btn-primary" onclick="startConnection()" id="startBtn">
                â–¶ï¸ Ø´Ø±ÙˆØ¹ Ø¯Ø±ÛŒØ§ÙØª
            </button>
            <button class="btn" onclick="takeSnapshot()" id="snapshotBtn" disabled>
                ğŸ“¸ Ø¹Ú©Ø³ Ø¨Ú¯ÛŒØ±
            </button>
            <button class="btn" onclick="toggleFullscreen()">
                â›¶ ØªÙ…Ø§Ù… ØµÙØ­Ù‡
            </button>
        </div>
    </div>
    
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <script>
        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ
        let peer = null;
        let connection = null;
        let currentStream = null;
        let peerId = null;
        
        // Ø¹Ù†Ø§ØµØ± DOM
        const peerIdDisplay = document.getElementById('peerIdDisplay');
        const phoneUrlDisplay = document.getElementById('phoneUrlDisplay');
        const remoteVideo = document.getElementById('remoteVideo');
        const videoPlaceholder = document.getElementById('videoPlaceholder');
        const connectionStatus = document.getElementById('connectionStatus');
        const cameraStatus = document.getElementById('cameraStatus');
        const qualityStatus = document.getElementById('qualityStatus');
        const liveBadge = document.getElementById('liveBadge');
        const startBtn = document.getElementById('startBtn');
        const snapshotBtn = document.getElementById('snapshotBtn');
        const disconnectBtn = document.getElementById('disconnectBtn');
        const notification = document.getElementById('notification');
        
        // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        initialize();
        
        async function initialize() {
            try {
                showNotification('ğŸš€ Ø¯Ø± Ø­Ø§Ù„ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø³ÛŒØ³ØªÙ…...');
                
                // Ø§ØªØµØ§Ù„ Ø¨Ù‡ PeerJS Ø³Ø±ÙˆØ±
                await connectToPeerServer();
                
                // Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª ØªÙ…Ø§Ø³
                prepareForIncomingCalls();
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù„ÛŒÙ†Ú© Ú¯ÙˆØ´ÛŒ
                updatePhoneUrl();
                
                showNotification('âœ… Ø³ÛŒØ³ØªÙ… Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª');
                
            } catch (error) {
                console.error('Initialize error:', error);
                showNotification('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ');
            }
        }
        
        function connectToPeerServer() {
            return new Promise((resolve, reject) => {
                // Ø§ØªØµØ§Ù„ Ø¨Ù‡ PeerJS Ø³Ø±ÙˆØ± Ø®ÙˆØ¯Ù…Ø§Ù†
                peer = new Peer({
                    host: window.location.hostname,
                    port: window.location.port || 443,
                    path: '/peerjs',
                    debug: 3
                });
                
                peer.on('open', (id) => {
                    peerId = id;
                    peerIdDisplay.textContent = id;
                    console.log('ğŸ–¥ï¸ Computer Peer ID:', id);
                    
                    connectionStatus.textContent = 'ğŸŸ¢ Ø¢Ù…Ø§Ø¯Ù‡';
                    connectionStatus.className = 'status-value status-online';
                    
                    resolve();
                });
                
                peer.on('error', (error) => {
                    console.error('Peer error:', error);
                    connectionStatus.textContent = 'ğŸ”´ Ø®Ø·Ø§';
                    connectionStatus.className = 'status-value status-offline';
                    reject(error);
                });
                
                peer.on('disconnected', () => {
                    connectionStatus.textContent = 'ğŸ”Œ Ù‚Ø·Ø¹';
                    connectionStatus.className = 'status-value status-offline';
                });
                
                peer.on('close', () => {
                    connectionStatus.textContent = 'âŒ Ø¨Ø³ØªÙ‡';
                    connectionStatus.className = 'status-value status-offline';
                });
            });
        }
        
        function prepareForIncomingCalls() {
            peer.on('call', async (incomingCall) => {
                console.log('ğŸ“ Ø¯Ø±ÛŒØ§ÙØª ØªÙ…Ø§Ø³ Ø§Ø²:', incomingCall.peer);
                
                try {
                    // Ù‚Ø¨ÙˆÙ„ ØªÙ…Ø§Ø³ (Ø¨Ø¯ÙˆÙ† Ø§Ø±Ø³Ø§Ù„ stream Ø§Ø² Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ±)
                    connection = incomingCall;
                    
                    // Ø¯Ø±ÛŒØ§ÙØª stream Ø§Ø² Ú¯ÙˆØ´ÛŒ
                    connection.on('stream', (remoteStream) => {
                        handleIncomingStream(remoteStream);
                    });
                    
                    connection.on('close', () => {
                        handleCallEnded();
                    });
                    
                    connection.on('error', (error) => {
                        console.error('Call error:', error);
                        handleCallEnded();
                    });
                    
                    // Ù¾Ø§Ø³Ø® Ø¨Ù‡ ØªÙ…Ø§Ø³
                    await connection.answer();
                    
                } catch (error) {
                    console.error('Error answering call:', error);
                    showNotification('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª ØªÙ…Ø§Ø³');
                }
            });
        }
        
        function handleIncomingStream(remoteStream) {
            console.log('ğŸ¥ Ø¯Ø±ÛŒØ§ÙØª stream Ø§Ø² Ú¯ÙˆØ´ÛŒ');
            
            currentStream = remoteStream;
            remoteVideo.srcObject = remoteStream;
            remoteVideo.style.display = 'block';
            videoPlaceholder.style.display = 'none';
            liveBadge.style.display = 'block';
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª
            cameraStatus.textContent = 'ğŸ“¹ ÙØ¹Ø§Ù„';
            cameraStatus.className = 'status-value status-online';
            connectionStatus.textContent = 'ğŸ”— Ù…ØªØµÙ„';
            connectionStatus.className = 'status-value status-online';
            
            // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
            snapshotBtn.disabled = false;
            disconnectBtn.disabled = false;
            startBtn.disabled = true;
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©ÛŒÙÛŒØª
            updateVideoQuality();
            
            showNotification('âœ… Ø¯ÙˆØ±Ø¨ÛŒÙ† Ú¯ÙˆØ´ÛŒ Ù…ØªØµÙ„ Ø´Ø¯');
        }
        
        function handleCallEnded() {
            console.log('ğŸ”Œ ØªÙ…Ø§Ø³ Ù¾Ø§ÛŒØ§Ù† ÛŒØ§ÙØª');
            
            if (remoteVideo.srcObject) {
                remoteVideo.srcObject.getTracks().forEach(track => track.stop());
            }
            
            remoteVideo.style.display = 'none';
            videoPlaceholder.style.display = 'block';
            liveBadge.style.display = 'none';
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª
            cameraStatus.textContent = 'ğŸ“´ ØºÛŒØ±ÙØ¹Ø§Ù„';
            cameraStatus.className = 'status-value status-offline';
            connectionStatus.textContent = 'â³ Ù…Ù†ØªØ¸Ø±';
            connectionStatus.className = 'status-value status-offline';
            qualityStatus.textContent = '--';
            
            // ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
            snapshotBtn.disabled = true;
            disconnectBtn.disabled = true;
            startBtn.disabled = false;
            
            showNotification('ğŸ”Œ Ø§ØªØµØ§Ù„ Ù‚Ø·Ø¹ Ø´Ø¯');
        }
        
        function updateVideoQuality() {
            if (!remoteVideo.videoWidth) return;
            
            const width = remoteVideo.videoWidth;
            const height = remoteVideo.videoHeight;
            
            let quality = 'Ù…ØªÙˆØ³Ø·';
            if (width >= 1280 && height >= 720) {
                quality = 'HD (720p)';
            } else if (width >= 1920 && height >= 1080) {
                quality = 'Full HD (1080p)';
            } else if (width >= 640 && height >= 480) {
                quality = 'SD (480p)';
            }
            
            qualityStatus.textContent = `${quality} (${width}Ã—${height})`;
        }
        
        function updatePhoneUrl() {
            if (!peerId) return;
            
            const baseUrl = window.location.origin;
            const phoneUrl = `${baseUrl}/phone?id=${peerId}`;
            phoneUrlDisplay.textContent = `Ù„ÛŒÙ†Ú© Ú¯ÙˆØ´ÛŒ: ${phoneUrl}`;
        }
        
        function copyPeerId() {
            navigator.clipboard.writeText(peerId)
                .then(() => showNotification('âœ… Ø´Ù†Ø§Ø³Ù‡ Ú©Ù¾ÛŒ Ø´Ø¯'))
                .catch(() => showNotification('âŒ Ø®Ø·Ø§ Ø¯Ø± Ú©Ù¾ÛŒ'));
        }
        
        function copyPhoneUrl() {
            const phoneUrl = `${window.location.origin}/phone?id=${peerId}`;
            navigator.clipboard.writeText(phoneUrl)
                .then(() => showNotification('âœ… Ù„ÛŒÙ†Ú© Ú©Ù¾ÛŒ Ø´Ø¯'))
                .catch(() => showNotification('âŒ Ø®Ø·Ø§ Ø¯Ø± Ú©Ù¾ÛŒ'));
        }
        
        function startConnection() {
            showNotification('ğŸ” Ø¯Ø± Ø­Ø§Ù„ Ø¬Ø³ØªØ¬ÙˆÛŒ Ú¯ÙˆØ´ÛŒ...');
            connectionStatus.textContent = 'ğŸ” Ø¬Ø³ØªØ¬Ùˆ...';
        }
        
        function takeSnapshot() {
            if (!currentStream) return;
            
            const canvas = document.createElement('canvas');
            canvas.width = remoteVideo.videoWidth;
            canvas.height = remoteVideo.videoHeight;
            
            const ctx = canvas.getContext('2d');
            ctx.drawImage(remoteVideo, 0, 0, canvas.width, canvas.height);
            
            const link = document.createElement('a');
            link.download = `snapshot-${Date.now()}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
            
            showNotification('ğŸ“¸ Ø¹Ú©Ø³ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
        }
        
        function disconnectAll() {
            if (connection) {
                connection.close();
            }
            handleCallEnded();
        }
        
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                remoteVideo.requestFullscreen().catch(err => {
                    console.log('Fullscreen error:', err);
                });
            } else {
                document.exitFullscreen();
            }
        }
        
        function showNotification(message) {
            notification.textContent = message;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 4000);
        }
        
        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯ÙˆØ±Ù‡â€ŒØ§ÛŒ Ú©ÛŒÙÛŒØª
        setInterval(() => {
            if (remoteVideo.srcObject && remoteVideo.videoWidth > 0) {
                updateVideoQuality();
            }
        }, 3000);
        
        // ÙˆÙ‚ØªÛŒ ØµÙØ­Ù‡ Ù„ÙˆØ¯ Ø´Ø¯
        window.addEventListener('load', () => {
            console.log('ğŸ® Ù¾Ù†Ù„ Ú©Ù†ØªØ±Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯');
        });
        
        // ÙˆÙ‚ØªÛŒ ØµÙØ­Ù‡ Ø¨Ø³ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
        window.addEventListener('beforeunload', () => {
            if (connection) {
                connection.close();
            }
            if (peer) {
                peer.destroy();
            }
        });
        
    </script>
</body>
</html>